---
title: "US Overweight and Obesity (BMI) Analysis (From 2011 to Present)"
author: "ChenXin Zhang (cz2634), JingYao Geng (jg4294), Liner Ge (lg3156), YiFan Su (ys3394)"
output: 
  html_document:
    toc: TRUE
    toc_float: TRUE
    code_folding: hide
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
library(tidyverse)
library(plotly)
library(rvest)
library(readr)
library(leaflet)
library(patchwork)
library(RColorBrewer)
knitr::opts_chunk$set(
	echo = TRUE,
	warning = FALSE,
	fig.width = 8, 
  fig.height = 6,
  out.width = "80%",
	warning = FALSE,
	message = FALSE
)
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)
scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
theme_set(theme_minimal() + theme(legend.position = "bottom",plot.title = element_text(face = "bold")))
```

  
# Motivation
According to [the World Health Organization (WHO)](https://www.who.int/news-room/fact-sheets/detail/obesity-and-overweight), more than two-thirds of adults are obese or overweight and one-sixth of children are obese in the US. Obesity is [the fifth leading risk](https://easo.org/media-portal/statistics/) for global death. People overweight have a higher risk of getting more than [60 chronic diseases](https://www.healthline.com/health/obesity-facts) like type 2 diabetes, heart disease, which also increases the medical cost. The association between obesity and education level, income is intricate and differs by gender, age, and race.

# Related Work

A combination of contributing factors such as gender, age, race, genetic, physical activity, inactivity, dietary patterns and other factors are related to obese and obesity, which is complex and need statistic analysis to clarify. We get inspired from sources related to these influence factors: 

[What causes obesity & overweight](https://www.nichd.nih.gov/health/topics/obesity/conditioninfo/cause)
[Impact of Obesity on your Body](https://asmbs.org/patients/impact-of-obesity)
[Gender Disparities in Obesity](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3649717/)
[Age and the Prevalence of Obesity](https://www.bahrainmedicalbulletin.com/june_2002/relationship.pdf)
[Social and Environmental Factors Influencing Obesity](https://www.ncbi.nlm.nih.gov/books/NBK278977/)

# Initial Questions
* How obese/overweight change from 2011 to present in the US?
* How gender, race, education level, household income are associated with obese and overweight over the US?
* Which state has highest average obese and overweight per year among all the states? And what is the distribution of obese/overweight by gender, race, education level, household income in the state?

# Data
## Data source
  * Primary data source: [Data collected from Behavioral Risk Factor Sureillance System (BRFSS)](https://chronicdata.cdc.gov/Behavioral-Risk-Factors/BRFSS-Table-of-Overweight-and-Obesity-BMI-/fqb7-mgjf)  
  * Supplemental data source: [Centers for Diseases Control and Prevention (CDC)](https://www.cdc.gov/obesity/data/prevalence-maps.html#age)

## Variable of Interest  

**Outcomes**

  * `obese_overweight:` Count of obese and overweight per year of all sates.
  * `obese_overweight_rate:` Prevalence. Getting it by dividing the number of people with obese/overweight by total number of population in data multiplied by 100.  
  

**Candidate Predictors**

  * `year:` 2011 - 2019
  * `locationabbr:` state abbreviation, 56 states
  * `locationdesc:` state name, 56 states
  * `response:` Normal Weight (BMI 18.5-24.9); Obese (BMI 30.0 - 99.8); Overweight (BMI 25.0-29.9); Underweight (BMI 12.0-18.4); Underweight (bmi 12.0-18.4);Normal Weight (bmi 18.5-24.9); Obese (bmi 30.0 - 99.8); Overweight (bmi 25.0-29.9)
  * `break_out_category:` Race/Ethnicity; Age Group; Household Income; Education Attained; Gender; Overall 
  
  * `break_out:` Male; College graduate; White, non-Hispanic; `$35,000-$49,999`; `$25,000-$34,999`; `$15,000-$24,999`; 35-44; 25-34; 18-24; 55-64; (Other) ; Overall; Some post-H.S.
  * `sample_size:` Number of people in each category
  * `data_value:` crude prevalence, unit %, such as 14.7 means 14.7%
  * `confidence_limit_low:` The value that rank the 25%th of the tatall value
  * `confidence_limit_high:` The value that rank the 75%th of the tatall value
  * `geo_location:` Longitude and latitude
  * `break_out_category_id:` gender(CAT2), age(CAT3), race/ethnicity(CAT4), education(CAT5)
  * `breakout_id:` eg: SEX1, SEX2, (in CAT2)
  * `location_id:` eg: 01, stands for different state
  * `response_id:` eg: RESP041.  

## Data Cleaning

First, import the data from Behavioral Risk Factor Sureillance System. We clean the data and create four data frames based on the predictors(gender, race, education level, household income) for future analysis. 
```{r eval = FALSE}
load_df =
GET("https://chronicdata.cdc.gov/resource/fqb7-mgjf.csv",
    query = list("$limit" = 50000)) %>% 
  content("parsed") %>% 
  janitor::clean_names()


tidy_df = 
  load_df %>% 
  filter(is.na(data_value_footnote)) %>% 
  dplyr::select(-class, -topic, -question, -data_value_unit, -data_value_type, -data_source, -data_value_footnote_symbol, -data_value_footnote, -question_id, -class_id, -topic_id, -states, -counties) 

head(tidy_df) 

#gender
gender_df = 
  tidy_df %>% 
  filter(break_out_category_id == "CAT2") 
head(gender_df) 

#race
race_df = 
  tidy_df %>% 
  filter(break_out_category_id == "CAT4") 
head(race_df)

#education
education_df = 
  tidy_df %>% 
  filter(break_out_category_id == "CAT5") 
head(education_df) 
```

To get a time trend of obese/overweight for each state, we calculate prevalence in each year for each state. Using functions like `summary`, `group`, `filter` to calculate total population in each year for each state and total population in each year for each state.

```{r eval = FALSE}
# total population in each state in each year
df.tot = load_df %>%
  group_by(year,locationdesc) %>%
  summarise(state_sum = sum(sample_size))

# total 'obese' and 'overweight' amount in each state in each year
df.overweight = 
  load_df %>%
  filter(response %in% c("Obese (BMI 30.0 - 99.8)","Overweight (BMI 25.0-29.9)",
                         "Obese (bmi 30.0 - 99.8)","Overweight (bmi 25.0-29.9)")) %>%
  group_by(year,locationdesc) %>%
  summarise(state_overweight_sum = sum(sample_size))


df.rate = left_join(df.tot, df.overweight,
                   by = c("year" , "locationdesc")) %>%
  mutate(over_rate = state_overweight_sum/state_sum)

```
Next, cleaning data to find the state with highest average obese and overweight per year among all the states. After grouping data by locations and summing up mean value of obese/overweight, we find Nebraska has the highest average obese and overweight and we will choose this state for futher analysis.
```{r eval=FALSE}
#cleaning data for nebraska
df.highest = df.rate %>% 
  group_by(locationdesc) %>%
  summarise(mean_overweight = mean(state_overweight_sum)) %>%
  filter(mean_overweight == max(mean_overweight)) 


kable(df.highest, row.names = T, escape = F) %>%
  kable_styling(bootstrap_options = "striped", full_width = F)
```

After choosing to focus on Nebraska, data were limited to this state. Dividing the number of people with obese/overweight by total number of population in the selected data multiplied by 100 to get the prevalence of obese/overweight for each year in Nebraska. Based on the data, we will visualize the obese/overweight differences by race, gender, education, and household income.

```{r , eval = FALSE}
# prevalence of obese/obesity in Nebraska
time_df = 
  ne_df %>% 
  filter(response_id %in% c("RESP039", "RESP040") ) %>% 
  select(year, response_id, sample_size) %>% 
  group_by(year, response_id) %>% 
  mutate(count_obese = sum(sample_size)) %>% 
  select(-sample_size) %>% 
  distinct()

total_df = 
  ne_df %>%
  select(year, response_id, sample_size) %>% 
  group_by(year) %>% 
  mutate(count_total = sum(sample_size)) %>% 
  select(-sample_size) %>% 
  filter(response_id %in% c("RESP039", "RESP040") ) %>% 
  distinct() 

rate_time = 
  left_join(time_df, total_df,by = c("year" , "response_id")) %>% 
  mutate(
    prevalence = count_obese / count_total,
    rate_lable = case_when(
      response_id == "RESP039" ~ "Obese (BMI 30.0 - 99.8)",
      response_id == "RESP040" ~ "Overweight (BMI 25.0-29.9)"
    )
    ) %>%
  mutate(prevalence = round(prevalence, digits = 4)) 
```

# Exploratory Analysis

**How obese/overweight change from 2011 to present in the US?**
It is clear that **all states** have as **increasing** trend of obese and overweight amount from 2011 to 2019.
```{r  eval = FALSE}
# Use library(plotly) to visualizing the US obesity and overweight rate geographically (on a map), including the average amount of obesity and overweight from 2011 to 2019.
df.rate1 =  df.rate %>%
  group_by(locationdesc)  %>%
  mutate(mean_amount = mean(state_overweight_sum))

df.rate1 = df.rate1[-which(df.rate1$locationdesc %in% c("All States and DC (median) **","All States, DC and Territories (median) **","Virgin Islands") ),]
df.rate1$region = tolower(df.rate1$locationdesc)

states = map_data("state")
# merge the datasets
states = merge(states, df.rate1, by = "region", all.x = T)

##### US states obesity time trend: scatter plot with line
ggplot(data = df.rate[-which(df.rate$locationdesc %in% c("All States and DC (median) **","All States, DC and Territories (median) **","Virgin Islands") ),], 
       aes(year, y = over_rate)) +
  geom_line(aes(color = locationdesc)) +
  geom_point(aes(color = locationdesc),size = 1.5) +
  facet_wrap(~ locationdesc) +
  theme(legend.position = "None",
        #text = element_text(family='Kai'),
        axis.text.x = element_text(angle = 90, hjust = 1)) +
  scale_x_continuous(breaks = seq(2011,2019,1)) +
  xlab("Year") + ylab("Obesity and overweight rate") +
  ggtitle("Obesity and overweight rate trend for all the states")
```


**What is the distribution of obese/overweight by gender, race, education level, household income in Nebraska?**

According to overview, Nebraska owns the highest rate of overweight and obese. From the line plot, we can see the prevalence of overweight decreased slightly while the prevalence of obese increased significantly over year. The total rate of people whose BMI is greater than 25 reaches almost 70% _(rate of obese is 36%)_ in 2019.

* How gender, race, education level, household income are associated with obese and overweight over the US?



#### Association between Obese and Gender
#### Proportion of obesity by gender
#### ...


# Additional Analysis

# Discussion


